<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Mengwen&#39;s blog</title>
  <meta name="google-site-verification" content="b4Ue0TSagJytS36Ka3C7UAekObDLixDjui1eoo1827s" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Some random notes...">
<meta property="og:type" content="website">
<meta property="og:title" content="Mengwen&#39;s blog">
<meta property="og:url" content="https://mli9502.github.io/index.html">
<meta property="og:site_name" content="Mengwen&#39;s blog">
<meta property="og:description" content="Some random notes...">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mengwen&#39;s blog">
<meta name="twitter:description" content="Some random notes...">
  
    <link rel="alternate" href="/atom.xml" title="Mengwen&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Mengwen&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://mli9502.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-leetcode-850-Rectangle-Area-II" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/14/leetcode-850-Rectangle-Area-II/" class="article-date">
  <time datetime="2018-11-14T13:28:10.000Z" itemprop="datePublished">2018-11-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/14/leetcode-850-Rectangle-Area-II/">leetcode 850 - Rectangle Area II</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://mli9502.github.io/2018/11/14/leetcode-850-Rectangle-Area-II/" data-id="cjr8qyr23000krg6t28mi882w" class="article-share-link">Share</a>
      
        <a href="https://mli9502.github.io/2018/11/14/leetcode-850-Rectangle-Area-II/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Fenwick-Tree" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/14/Fenwick-Tree/" class="article-date">
  <time datetime="2018-11-14T13:26:58.000Z" itemprop="datePublished">2018-11-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/14/Fenwick-Tree/">Fenwick Tree</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://mli9502.github.io/2018/11/14/Fenwick-Tree/" data-id="cjr8qyr1i0001rg6t6lm6e3g6" class="article-share-link">Share</a>
      
        <a href="https://mli9502.github.io/2018/11/14/Fenwick-Tree/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Segment-Tree" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/14/Segment-Tree/" class="article-date">
  <time datetime="2018-11-14T13:26:12.000Z" itemprop="datePublished">2018-11-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/14/Segment-Tree/">Segment Tree</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://mli9502.github.io/2018/11/14/Segment-Tree/" data-id="cjr8qyr1s0008rg6t4xzk7r5p" class="article-share-link">Share</a>
      
        <a href="https://mli9502.github.io/2018/11/14/Segment-Tree/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-leetcode-765-Couples-Holding-Hands" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/24/leetcode-765-Couples-Holding-Hands/" class="article-date">
  <time datetime="2018-10-25T02:18:53.000Z" itemprop="datePublished">2018-10-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/24/leetcode-765-Couples-Holding-Hands/">leetcode 765 - Couples Holding Hands</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://leetcode.com/problems/couples-holding-hands/description/" target="_blank" rel="noopener">leetcode 765 - Couples Holding Hands</a></p>
<p><a href="https://leetcode.com/problems/couples-holding-hands/discuss/117520/Java-union-find-easy-to-understand-5-ms" target="_blank" rel="noopener">A Union-Find solution</a></p>
<p>We first assign groups to elements in the array.</p>
<p>For example, given array <code>[2, 1, 5, 0, 3, 4]</code>, we assign groups as the following:</p>
<ul>
<li><code>[0, 1]</code>: group <code>0</code></li>
<li><code>[2, 3]</code>: group <code>2</code></li>
<li><code>[4, 5]</code>: group <code>4</code></li>
</ul>
<p>To get the group number for a given array element, we can use <code>arr[i] &amp; (~0x1)</code>.</p>
<p>As a result, if we represent <code>[2, 1, 5, 0, 3, 4]</code> in group labels, we get <code>[2, 0, 4, 0, 2, 4]</code>.</p>
<p>We visualize each group as a vertax of a undirected graph. </p>
<p>The initial connection of these vertaxes are determined by the pairs in the given array.</p>
<p>For example, if the array is <code>[0, 0, 2, 2, 4, 4]</code>, we get the following graph:</p>
<p><img src="/images/leetcode-765-Couples-Holding-Hands-0.png" alt="graph 0"></p>
<p>If the array is <code>[2, 0, 4, 0, 2, 4]</code>, we get:</p>
<p><img src="/images/leetcode-765-Couples-Holding-Hands-1.png" alt="graph 1"></p>
<p>Assume the size of the input array is <code>N</code>, If all the couples are seat next to each other, we want the graph to have exactly <code>N / 2</code> connected components as shown in the <code>[0, 0, 2, 2, 4, 4]</code> graph.</p>
<hr>
<p>After we convert the input array into an undirected graph, we convert the problem to:</p>
<p><code>Given this undirected graph with (N / 2) vertices, and at most two edges for a vertex, what is the minimum swaps needed to convert this graph to a graph that has exactly (N / 2) connected components?</code></p>
<p>We can observe that, for the given kind of graph, every swap is guaranteed to break one vertex free if it is in a connected component, and thus, increase the total number of connected component by <code>1</code>.</p>
<p>For example, for the array <code>[2, 0, 4, 0, 2, 4]</code>, after we swap idx <code>0</code> with idx <code>3</code>, we get <code>[0, 0, 4, 2, 2, 4]</code>. By doing this, we break vertex <code>0</code> free, and increase the connected component count from <code>1</code> to <code>2</code>.</p>
<p>As a result, we can conclude that <code>(the # of components we increased) == (the # of swaps we have to do)</code></p>
<p>Our gaol is to increase the total number of components to <code>N / 2</code>. Thus we have <code>(origional # of components) + (# of components we have to increase) == N / 2</code>.</p>
<p>As a result, we have:<br><code>(# of swaps we have to do) == (# of components we have to increase) == N / 2 - (origional # of components)</code></p>
<p>So, the problem now is converted to find <code>(origional # of connected components)</code> in this undirected graph.</p>
<hr>
<p>In order to find the origional number of connected components, we can do the following:</p>
<p>If we start with <code>N / 2</code> connected components, each time we find a new edge between two components, we have to reduce the number of our connected components by <code>1</code>.</p>
<p>For example, for array <code>[0, 2, 2, 0, 4, 4]</code>, we should have <code>2</code> connected components: <code>0 - 2</code> and <code>4</code>. If we start our component count at <code>3</code>, when we see the first pair <code>[0, 2]</code>, we know that component <code>0</code> and <code>2</code> are connected, so we reduce our component count to <code>2</code>. Then, we see pair <code>[2, 0]</code>, but since we already handled <code>[0, 2]</code>, we don’t have to handle <code>[2, 0]</code> again since the graph is undirected. So, in the end, we find out that we have <code>2</code> connected components in the graph generated by <code>[0, 2, 2, 0, 4, 4]</code>.</p>
<p>To achieve this, we can use Union-Find method. </p>
<p>We inspect one pair every time. If the two elements are not already in one group, we know that a new edge is now being added, which means we have to decrease the count of our connected components by <code>1</code>. Then, we union these two groups.</p>
<p>The implementation is as following:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">minSwapsCouples</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; row)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; hm;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; row.size(); i ++) &#123;</span><br><span class="line">        <span class="comment">// Assign group label to couples.</span></span><br><span class="line">        <span class="comment">// 0 1: 0</span></span><br><span class="line">        <span class="comment">// 2 3: 2</span></span><br><span class="line">        <span class="comment">// 4 5: 4</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        hm[row[i]] = row[i] &amp; (~<span class="number">0x1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// For each pair, if they are in two groups, we union the two groups together.</span></span><br><span class="line">    <span class="comment">// Every time we do a union, we have one less connected components.</span></span><br><span class="line">    <span class="comment">// The maximum number of connected components we can have is the number of couples, which is row.size() / 2.</span></span><br><span class="line">    <span class="keyword">int</span> maxNumOfConnectedComps = row.size() / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> initConnectedComps = maxNumOfConnectedComps;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; row.size(); i += <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> g1 = uf_find(hm, row[i]);</span><br><span class="line">        <span class="keyword">int</span> g2 = uf_find(hm, row[i + <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span>(g1 != g2) &#123;</span><br><span class="line">            uf_union(hm, g1, g2);</span><br><span class="line">            initConnectedComps --;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Now, initConnectedComps represents the number of connected components we have.</span></span><br><span class="line">    <span class="comment">// # of swaps needed = max # of connected components - # of connected components we have.</span></span><br><span class="line">    <span class="comment">// This is because in a given connected component, for each swap, we can at most generate one additional connected component.</span></span><br><span class="line">    <span class="comment">// So, # of swaps needed + # of connected components we currently have = max # of connected components.</span></span><br><span class="line">    <span class="keyword">return</span> maxNumOfConnectedComps - initConnectedComps;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">uf_union</span><span class="params">(<span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&amp; hm, <span class="keyword">int</span> g1, <span class="keyword">int</span> g2)</span> </span>&#123;</span><br><span class="line">    hm[g2] = g1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">uf_find</span><span class="params">(<span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&amp; hm, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(hm[val] == val) &#123;</span><br><span class="line">        <span class="keyword">return</span> val;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uf_find(hm, hm[val]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mli9502.github.io/2018/10/24/leetcode-765-Couples-Holding-Hands/" data-id="cjr8qyr1v000crg6twcyjhoio" class="article-share-link">Share</a>
      
        <a href="https://mli9502.github.io/2018/10/24/leetcode-765-Couples-Holding-Hands/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/leetcode/">leetcode</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Articles-to-read" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/18/Articles-to-read/" class="article-date">
  <time datetime="2018-10-19T03:18:23.000Z" itemprop="datePublished">2018-10-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/18/Articles-to-read/">Articles to read</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Some articles I found interesting and want to read…</p>
<ul>
<li style="list-style: none"><input type="checkbox"> <a href="https://git-scm.com/book/en/v1/Git-Internals" target="_blank" rel="noopener">how git works internally</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mli9502.github.io/2018/10/18/Articles-to-read/" data-id="cjr8qyr1m0003rg6tedg5kce4" class="article-share-link">Share</a>
      
        <a href="https://mli9502.github.io/2018/10/18/Articles-to-read/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Misc/">Misc</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Stack-sortable-array" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/13/Stack-sortable-array/" class="article-date">
  <time datetime="2018-10-13T17:55:33.000Z" itemprop="datePublished">2018-10-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/13/Stack-sortable-array/">Stack-sortable array</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This algorithm can be used for <a href="https://leetcode.com/problems/132-pattern/description/" target="_blank" rel="noopener">leetcode 456</a>.</p>
<p>The problem is <a href="https://en.wikipedia.org/wiki/Stack-sortable_permutation" target="_blank" rel="noopener">Stack-sortable permutation</a>. The problem is to try to sort a array of numbers using only a single stack.</p>
<p>The input array is stack-sortable only if it does not contain <code>231</code> pattern.</p>
<p>As a result, we can check if the input sequence contains <code>231</code> pattern by checking if it is stack-sortable.</p>
<p>Also, we can check if the input sequence contains <code>132</code> pattern by reverse the input sequence first, then, check if it contains <code>231</code> pattern by checking if the reversed sequence is stack-sortable.</p>
<p>The algorithm is as following:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; stackSort(<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums) &#123;</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; st;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; rtn;</span><br><span class="line">    <span class="comment">// According to Wiki, every two different stack-sortable permutations produce a different Dyck string.</span></span><br><span class="line">    <span class="comment">// The Dyck string corresponds to push and pops.</span></span><br><span class="line">    <span class="comment">// It seems that even the sequence is not stack-sortable, it also corresponds to a Dyck string.</span></span><br><span class="line">    <span class="comment">// For example, both &#123;2, 3, 1&#125; and &#123;1, 3, 2&#125; corresponds to string "()(())".</span></span><br><span class="line">    <span class="built_in">string</span> dyck_lang = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.size(); i ++) &#123;</span><br><span class="line">        <span class="keyword">while</span>(!st.empty() &amp;&amp; nums[i] &gt; st.top()) &#123;</span><br><span class="line">            rtn.push_back(st.top());</span><br><span class="line">            st.pop();</span><br><span class="line">            dyck_lang.push_back(<span class="string">')'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        st.push(nums[i]);</span><br><span class="line">        dyck_lang.push_back(<span class="string">'('</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(!st.empty()) &#123;</span><br><span class="line">        rtn.push_back(st.top());</span><br><span class="line">        st.pop();</span><br><span class="line">        dyck_lang.push_back(<span class="string">')'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; dyck_lang &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> rtn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If the given input has a <code>231</code> pattern, say input is <code>231</code>, before <code>3</code> is pushed onto stack, <code>2</code> will be popped and added to result, but, <code>1</code> is less than <code>2</code> so it should be added before <code>2</code>.</p>
<p>Another way to solve the <code>132 Pattern</code> problem is as following:</p>
<p>We want to find <code>s1 &lt; s3 &lt; s2</code>. We start from the end of the input, and push the elements we get into a stack. </p>
<p>When the value we encounter is greater than the top of the stack, it means that we have a candidate for <code>s2</code>. This is because there are some values after <code>s2</code> that is less than <code>s2</code>. </p>
<p>Then, we start popping out the numbers from stack that are less than <code>s2</code> we found. And, we keep track of the <code>max</code> of the numbers we popped out. This <code>max</code> number is the <code>s3</code> we want to use for this <code>s2</code>. We want to keep the <code>max</code> because we want to have more possibility for <code>s1</code>.</p>
<p>If the value we encounter is smaller than the <code>s3</code> we recorded, we can say that we have found a <code>s1</code>. This is because the <code>s3</code> we recorded must have a <code>s2</code> corresponding to it (<code>s3 &lt; s2</code>). If we found a <code>s1</code> such that <code>s1 &lt; s3</code>, we know that we have found the <code>s1 &lt; s3 &lt; s2</code> sequence.</p>
<p>This solution can be found <a href="https://leetcode.com/problems/132-pattern/discuss/94071/Single-pass-C++-O(n" target="_blank" rel="noopener">here</a>-space-and-time-solution-(8-lines)-with-detailed-explanation.).</p>
<p>The implementation is as following:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">find132pattern</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> s3 = INT_MIN;</span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; st;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = nums.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i --) &#123;</span><br><span class="line">            <span class="comment">// If we found nums[i] &lt; s3, it means that we found s1 &lt; s3 &lt; s2 pattern. </span></span><br><span class="line">            <span class="keyword">if</span>(nums[i] &lt; s3) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// We found a s2 candidate.</span></span><br><span class="line">            <span class="keyword">if</span>(!st.empty() &amp;&amp; nums[i] &gt; st.top()) &#123;</span><br><span class="line">                s3 = INT_MIN;</span><br><span class="line">                <span class="keyword">while</span>(!st.empty() &amp;&amp; nums[i] &gt; st.top()) &#123;</span><br><span class="line">                    s3 = max(s3, st.top());</span><br><span class="line">                    st.pop();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            st.push(nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://mli9502.github.io/2018/10/13/Stack-sortable-array/" data-id="cjr8qyr1o0004rg6t7yluz469" class="article-share-link">Share</a>
      
        <a href="https://mli9502.github.io/2018/10/13/Stack-sortable-array/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/leetcode/">leetcode</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Algorithm-to-find-majority-element" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/05/Algorithm-to-find-majority-element/" class="article-date">
  <time datetime="2018-10-06T00:46:53.000Z" itemprop="datePublished">2018-10-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/05/Algorithm-to-find-majority-element/">Algorithm to find majority element</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This algorithm can be used for <a href="https://leetcode.com/problems/majority-element-ii/description/" target="_blank" rel="noopener">leetcode 229</a> and <a href="https://leetcode.com/problems/majority-element/description/" target="_blank" rel="noopener">leetcode 169</a>.</p>
<p>The algorithm is called <a href="https://en.wikipedia.org/wiki/Boyer%E2%80%93Moore_majority_vote_algorithm" target="_blank" rel="noopener">Boyer-Moore majority vote algorithm</a>.</p>
<p>A blog for this algorithm can be found <a href="https://gregable.com/2013/10/majority-vote-algorithm-find-majority.html" target="_blank" rel="noopener">here</a>.</p>
<p>This algorithm can solve the following problem: Given an unordered array of size <code>n</code> of int, find all the elements that appear more than <code>floor(n / k)</code> times, with <code>O(k - 1)</code> space complexity and <code>O(n * (k - 1))</code> time complexity.</p>
<p>The idea is:</p>
<ul>
<li>First, we allocate a vector of <code>k - 1</code> elements called <code>vals</code>. This is because we can have at most <code>k - 1</code> elements that satisfy the condition that it appears more than <code>floor(n / k)</code> times. We assign unique numbers to <code>vals</code>. We also allocate vector <code>counts</code> of size <code>k - 1</code> to record the number of times each value appears. <code>counts</code> is initialized to all zero.</li>
<li>Then, for each <code>num</code> in <code>nums</code>, we check all <code>k - 1</code> values.<ul>
<li>If <code>num</code> is the same as one of the <code>val</code>, we increase its <code>count</code>.</li>
<li>If <code>num</code> is not the same as any of the <code>val</code>, but we find a <code>val</code> with <code>count == 0</code>, we replace that <code>val</code> with <code>num</code>, and set its <code>count</code> back to <code>1</code>.</li>
<li>If <code>num</code> is not the same as any of the <code>val</code>, and for all the <code>val</code>s, we have <code>count &gt; 0</code>, we then decreace <code>count</code> for all the <code>val</code>s.</li>
</ul>
</li>
<li>Finally, we go through all the <code>k - 1</code> values we recorded. For each <code>val</code>, we find its actual appearance time in <code>nums</code>, if this count satisfy <code>new_count &gt; floor(n / k)</code>, then, <code>val</code> is a solution. If not, we discard this <code>val</code>.</li>
</ul>
<p>The c++ implementation is as following:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; majorityElements(<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> k) &#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vals(k - <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; counts(k - <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// Initialization.</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vals.size(); i ++) &#123;</span><br><span class="line">        vals[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> num : nums) &#123;</span><br><span class="line">        <span class="comment">// First check if there is a val that equals num.</span></span><br><span class="line">        <span class="keyword">bool</span> foundSame = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vals.size(); i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(vals[i] == num) &#123;</span><br><span class="line">                counts[i] ++;</span><br><span class="line">                foundSame = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(foundSame) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Then, check if there's a val with count 0.</span></span><br><span class="line">        <span class="keyword">bool</span> foundZeroCount = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vals.size(); i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(counts[i] == <span class="number">0</span>) &#123;</span><br><span class="line">                vals[i] = num;</span><br><span class="line">                counts[i] = <span class="number">1</span>;</span><br><span class="line">                foundZeroCount = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(foundZeroCount) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// If we do not find a val == num, nor we find a count == 0, we decrease all counts.</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vals.size(); i ++) &#123;</span><br><span class="line">            counts[i] --;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; rtn;</span><br><span class="line">    <span class="comment">// Then, for all the vals we recorded, we check if it is actually a majority element we want.</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> val : vals) &#123;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> num : nums) &#123;</span><br><span class="line">            <span class="keyword">if</span>(num == val) &#123;</span><br><span class="line">                cnt ++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(cnt &gt; nums.size() / k) &#123;</span><br><span class="line">            rtn.push_back(val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> rtn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mli9502.github.io/2018/10/05/Algorithm-to-find-majority-element/" data-id="cjr8qyr1p0005rg6t73itwnip" class="article-share-link">Share</a>
      
        <a href="https://mli9502.github.io/2018/10/05/Algorithm-to-find-majority-element/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/leetcode/">leetcode</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Algorithm-to-shuffle-an-array" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/26/Algorithm-to-shuffle-an-array/" class="article-date">
  <time datetime="2018-09-27T01:41:07.000Z" itemprop="datePublished">2018-09-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/26/Algorithm-to-shuffle-an-array/">Algorithm to shuffle an array</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This algorithm can be used for <a href="https://leetcode.com/problems/random-flip-matrix/description/" target="_blank" rel="noopener">leetcode 519</a>. The algorithm is called <a href="https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle#Fisher_and_Yates&#39;_original_method" target="_blank" rel="noopener">Fisher-Yates shuffle</a>.</p>
<p>The question is to output the index of an array in a random order (we don’t care the actual value stored at that position), and minimize the number of <code>rand()</code> called and also optimize for space and time complexity.</p>
<p>e.g.: Given array of size 6, the output may look like the following:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(0, 3), (0, 1), (0, 2), (0, 4), (0, 0), (0, 5)</span><br></pre></td></tr></table></figure></p>
<p>To achieve this, we can use the following code:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get a random number in range [minVal, maxVal].</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getRand</span><span class="params">(<span class="keyword">int</span> minVal, <span class="keyword">int</span> maxVal)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> rand() % (maxVal - minVal + <span class="number">1</span>) + minVal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; solution(<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; vec) &#123;</span><br><span class="line">	<span class="keyword">int</span> maxVal = vec.size() - <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; hm;</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; rtn;</span><br><span class="line">	<span class="comment">// We loop vec.size() times to get output all the index.</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vec.size(); i ++) &#123;</span><br><span class="line">		<span class="comment">// Choose a random index in range [0, maxVal].</span></span><br><span class="line">		<span class="keyword">int</span> randIdx = getRand(<span class="number">0</span>, maxVal);</span><br><span class="line">		<span class="keyword">int</span> currSelectedIdx;</span><br><span class="line">		<span class="comment">// If we have not seen randIdx before, </span></span><br><span class="line">		<span class="comment">// it means that randIdx is the current selected index, and we can just return it.</span></span><br><span class="line">		<span class="keyword">if</span>(hm.find(randIdx) == hm.end()) &#123;</span><br><span class="line">			currSelectedIdx = randIdx;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// If we have seen randIdx before, it means that randIdx has been selected before.</span></span><br><span class="line">			<span class="comment">// And, we need to select the index in hm[randIdx], which is what randIdx represents now.</span></span><br><span class="line">			currSelectedIdx = hm[randIdx];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// After the index for current iteration is determined, we need to swap it with the index represented by current maxVal.</span></span><br><span class="line">		<span class="comment">// If maxVal still represents maxVal.</span></span><br><span class="line">		<span class="keyword">if</span>(hm.find(maxVal) == hm.end()) &#123;</span><br><span class="line">			hm[randIdx] = maxVal;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// IMPORTANT !!!</span></span><br><span class="line">			<span class="comment">// If maxVal has been chosen before, and it now represents something else.</span></span><br><span class="line">			hm[randIdx] = hm[maxVal];</span><br><span class="line">		&#125;</span><br><span class="line">		maxVal --;</span><br><span class="line">		rtn.push_back(currSelectedIdx);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>This code can be easily extended to 2-D matrix, as we just have to convert <code>maxVal</code> into <code>rowCnt * colCnt - 1</code>. And <code>randIdx</code> has to be converted to <code>(row, col)</code> by using:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> row = randIdx / colCnt;</span><br><span class="line"><span class="keyword">int</span> col = randIdx % colCnt;</span><br></pre></td></tr></table></figure></p>
<p>Here’s an example of running the algorithm:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">init: </span><br><span class="line">map = &#123;&#125;</span><br><span class="line">[0, 1, 2, 3, 4, 5]</span><br><span class="line">rtn = []</span><br><span class="line">--- randIdx = 3 (from [0, 5])</span><br><span class="line">map = &#123;3: 5&#125;</span><br><span class="line">rtn = [3]</span><br><span class="line">[0, 1, 2, 5, 4, X]</span><br><span class="line">--- randIdx = 1 (from [0, 4])</span><br><span class="line">map = &#123;3: 5,</span><br><span class="line">       1: 4&#125;</span><br><span class="line">rtn = [3, 1]</span><br><span class="line">[0, 4, 2, 5, X, X]</span><br><span class="line">--- randIdx = 2 (from [0, 3])</span><br><span class="line">map = &#123;3: 5,</span><br><span class="line">       1: 4,</span><br><span class="line">       2: 5&#125;</span><br><span class="line">rtn = [3, 1, 2]</span><br><span class="line">[0, 4, 5, X, X, X]</span><br><span class="line">--- randIdx = 1 (from [0, 2])</span><br><span class="line">map = &#123;3: 5</span><br><span class="line">       1: 4,</span><br><span class="line">       2: 5&#125;</span><br><span class="line">rtn = [3, 1, 2, 4]</span><br><span class="line">[0, 5, X, X, X, X]</span><br><span class="line">--- randIdx = 0 (from [0, 1])</span><br><span class="line">map = &#123;3: 5</span><br><span class="line">       1: 4,</span><br><span class="line">       2: 5,</span><br><span class="line">       0, 5&#125;</span><br><span class="line">rtn = [3, 1, 2, 4, 0]</span><br><span class="line">[5, X, X, X, X, X]</span><br><span class="line">--- randIdx = 0 (from [0, 0])</span><br><span class="line">map = &#123;3: 5</span><br><span class="line">       1: 4,</span><br><span class="line">       2: 5,</span><br><span class="line">       0, 5&#125;</span><br><span class="line">rtn = [3, 1, 2, 4, 0, 5]</span><br><span class="line">[X, X, X, X, X, X]</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://mli9502.github.io/2018/09/26/Algorithm-to-shuffle-an-array/" data-id="cjr8qyr1a0000rg6tuyq9as2q" class="article-share-link">Share</a>
      
        <a href="https://mli9502.github.io/2018/09/26/Algorithm-to-shuffle-an-array/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/leetcode/">leetcode</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Hide-human-readable-information-in-c-binary" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/26/Hide-human-readable-information-in-c-binary/" class="article-date">
  <time datetime="2018-09-26T16:59:32.000Z" itemprop="datePublished">2018-09-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/26/Hide-human-readable-information-in-c-binary/">Hide human-readable information in c++ binary</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I was recently working on hiding human readable information from a binary compiled from c++ source code. </p>
<p>Here are some of the steps I took to hide as much human readable information from binary as possible.</p>
<h2 id="Encrypt-string-literals-in-source-code"><a href="#Encrypt-string-literals-in-source-code" class="headerlink" title="Encrypt string literals in source code"></a>Encrypt string literals in source code</h2><p>Since string literals will be put into <code>.rodata</code> section in binary, it is easy for user to read it simply by using the <code>strings</code> command in linux. </p>
<p>There are some ways mentioned online that use template meta programming to encrypt the string literals at compile time (and decrypt at run time). But, it require <code>c++11</code> standard to work. </p>
<p>Then, we found <a href="http://blog.sevagas.com/?String-encryption-using-macro-and" target="_blank" rel="noopener">this post</a> which does not need <code>c++11</code> to work. </p>
<p>The basic idea is to surround a macro around the string litrals you want to encrypt as following:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In a header file:</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SEC_STR(A) (decryptStr(A ## <span class="meta-string">"\0\."</span>))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// In the place where you want your string to be encrypted:</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"A string you want to hide in binary: %s"</span>, SEC_STR(<span class="string">"some secret..."</span>));</span><br></pre></td></tr></table></figure></p>
<p>The macro <code>SEC_STR</code> does two things:</p>
<ul>
<li><p>It adds a suffix <code>\0\.</code> after string <code>A</code>.</p>
<p>  According to the post, encryption is done by directly replace the string literals in binary to the encrypted version. As a result, it needs a way to make sure that the string it locates in binary is the string that user want’s to encrypt. So, after it finds a string in binary, it checks the suffix to see if it is a target string. </p>
</li>
<li><p>It calls the function <code>decryptStr</code> before return the string.</p>
<p>  By doing this, the actual string (which is the reutrn value of <code>decryptStr</code>) is used at <strong>run-time</strong>.</p>
</li>
</ul>
<p>However, the implementation in the blog have several problems:</p>
<ul>
<li><p>The <code>decryptStr</code> function uses a buffer to keep the decrypted string. </p>
<p>  This is a problem when multiple strings needs to be decrypted before they are used, e.g.:</p>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In helper.h:</span></span><br><span class="line"><span class="comment">// we would like to hide str1 and str2 in binary.</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">some_func_call</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str1, <span class="keyword">const</span> <span class="keyword">char</span>* str2)</span></span>;</span><br><span class="line"><span class="comment">// In helper.cpp:</span></span><br><span class="line">some_func_call(SEC_STR(<span class="string">"hello"</span>), SEC_STR(<span class="string">"world"</span>));</span><br></pre></td></tr></table></figure>
<p>  Before <code>some_func_call</code> is called at run-time, the <code>&quot;hello&quot;</code> and <code>&quot;world&quot;</code> need to be decrypted first.</p>
<p>  However, when <code>&quot;hello&quot;</code> is decrypted, the string <code>hello</code> is stored in the buffer. Then, when <code>&quot;world&quot;</code> is decrypted, it will overwrite the <code>hello</code> in the buffer. As a result, in the <code>some_func_call</code>, we get two <code>world</code> instead of <code>hello world</code>.</p>
<p>  This problem will also occure when multi-thread is used.</p>
<p>  But, this is relatively easy to fix. All we have to do is to use a global <code>std::map&lt;const char*, std::string&gt;</code> to store the strings we decrypted. </p>
</li>
<li><p>When we search for strings with our suffix in binary, there is a chance that there are some random string also have the same suffix. We could potentially break the binary when we encrypt the string.</p>
</li>
<li><p>If we use this method, the encrypted string must have the same length as the origional string, otherwise, we could also break the binary.</p>
</li>
</ul>
<p>To fix these problems, instead fo modifying the binary, we decided to encrypt all raw strings directly in the source file before compile.</p>
<p>This requires a regular expression to match all string literals in source code. A base one is provided <a href="https://stackoverflow.com/questions/41909225/regex-for-matching-c-string-constant" target="_blank" rel="noopener">here</a>.</p>
<ul>
<li style="list-style: none"><input type="checkbox"> Need to add the working sample.</li>
</ul>
<p>There are some benifits of using this solution:</p>
<ul>
<li><p>We can encode the string literal into anything we want. We don’t have to make sure that the encrypted string has the same length as the origional string.</p>
</li>
<li><p>We can choose the encryption and decryption algorithm we want.</p>
</li>
</ul>
<p>One problem for this approch is that the string we matched using regex can not handle escape characters correctly. All the escape characters are being interpreted literially when doing string encryption.</p>
<p>For example, <code>\n</code> will be treat as two characters, <code>\</code> and <code>n</code> when doing encryption, instead of being treated as ASCII character <code>LF</code> (10 in ASCII table). </p>
<p>As a result, when we decrypt the string, we do not get the <code>LF</code> character we want, instead, we get <code>\</code> and <code>n</code> which is not correct.</p>
<p>To fix this, we have to post-process the string matched by our regex into a vector of characters.</p>
<p>During post-process, we convert all the escape sequences into their corresponding ASCII characters. Then, when decrypt, we will get the correct output.</p>
<p>Another problem is that since we have to write the encrypted characters back into our source files, some of the encrypted characters are not printable nor human readable. So, to write them to the source file, we have to write the hexidecimal representation of the characters.</p>
<p>For example, assume <code>\n</code> is encrypted into character sequence <code>abc</code>. Then, in the source file, <code>\n</code> is then replaced with <code>\x61\x62\x63</code>.</p>
<h2 id="Replace-FILE-FUNCTION-and-PRETTY-FUNCTION"><a href="#Replace-FILE-FUNCTION-and-PRETTY-FUNCTION" class="headerlink" title="Replace __FILE__, __FUNCTION__ and __PRETTY_FUNCTION__"></a>Replace <code>__FILE__</code>, <code>__FUNCTION__</code> and <code>__PRETTY_FUNCTION__</code></h2><p>Since <code>__FILE__</code>, <code>__FUNCTION__</code> and <code>__PRETTY_FUNCTION__</code> will be replace by pre-processor to string literals, it will be added to the <code>.rodata</code> section of the binary. </p>
<p>To prevent this, we can write our own script to pre-process the source files to replace all these macros to empty string. </p>
<p>For the <code>__FILE__</code> macro, we can actually easily replace it with the actual file name string when we do our pre-process. But for <code>__FUNCTION__</code> and <code>__PRETTY_FUNCTION__</code>, it’s harder for a simple pre-process script to actually figure out what they should be replaced with.</p>
<p>This pre-process should be done before we start extracting and encrypting strings. </p>
<h2 id="Do-not-use-virtual-methods-for-classes-that-you-want-to-hide-name"><a href="#Do-not-use-virtual-methods-for-classes-that-you-want-to-hide-name" class="headerlink" title="Do not use virtual methods for classes that you want to hide name"></a>Do not use <code>virtual</code> methods for classes that you want to hide name</h2><p>If a class contains <code>virtual</code> methods, its name will be put into <code>rodata._ZTS&lt;class_name&gt;</code> section in the binary. Because this information is needed for <code>dynamic_cast</code> and exceptions. </p>
<p>If the code base does not use RTTI features, <code>-fno-rtti</code> can be added to the compiler flag to prevent these information from being generated.</p>
<p>Some useful links on <code>rodata._ZTI</code> and <code>rodata._ZTS</code> sections:</p>
<ul>
<li><a href="https://shaharmike.com/cpp/vtable-part1/" target="_blank" rel="noopener">https://shaharmike.com/cpp/vtable-part1/</a></li>
<li><a href="ftp://gcc.gnu.org/pub/gcc/summit/2003/Getting%20the%20Best%20from%20G++.pdf" target="_blank" rel="noopener">ftp://gcc.gnu.org/pub/gcc/summit/2003/Getting%20the%20Best%20from%20G++.pdf</a></li>
<li><a href="https://stackoverflow.com/questions/49381011/what-does-ztv-zts-zti-mean-in-the-result-of-gdb-x-nfu-vtable-address" target="_blank" rel="noopener">https://stackoverflow.com/questions/49381011/what-does-ztv-zts-zti-mean-in-the-result-of-gdb-x-nfu-vtable-address</a></li>
</ul>
<h2 id="Try-to-remove-rdynamic-flag"><a href="#Try-to-remove-rdynamic-flag" class="headerlink" title="Try to remove -rdynamic flag"></a>Try to remove <code>-rdynamic</code> flag</h2><p>If our final target is an executable, we can probably remove the <code>-rdynamic</code> flag. </p>
<p>This will prevent a lot of symbols from being exported.</p>
<ul>
<li><a href="https://stackoverflow.com/questions/36692315/what-exactly-does-rdynamic-do-and-when-exactly-is-it-needed" target="_blank" rel="noopener">https://stackoverflow.com/questions/36692315/what-exactly-does-rdynamic-do-and-when-exactly-is-it-needed</a></li>
</ul>
<h2 id="Try-adding-fvisibility-hidden-and-exclude-libs-ALL"><a href="#Try-adding-fvisibility-hidden-and-exclude-libs-ALL" class="headerlink" title="Try adding -fvisibility=hidden and --exclude-libs,ALL"></a>Try adding <code>-fvisibility=hidden</code> and <code>--exclude-libs,ALL</code></h2><p><code>-fvisibility=hidden</code> makes all symbols hidden by default. </p>
<p><code>--exclude-libs,ALL</code> excludes symbols in all archive libraries from automatic export.</p>
<ul>
<li><a href="https://stackoverflow.com/questions/3570355/c-fvisibility-hidden-fvisibility-inlines-hidden" target="_blank" rel="noopener">https://stackoverflow.com/questions/3570355/c-fvisibility-hidden-fvisibility-inlines-hidden</a></li>
<li><a href="https://sourceware.org/binutils/docs/ld/Options.html" target="_blank" rel="noopener">https://sourceware.org/binutils/docs/ld/Options.html</a></li>
</ul>
<h2 id="Add-DNDEBUG-as-compiler-flag"><a href="#Add-DNDEBUG-as-compiler-flag" class="headerlink" title="Add -DNDEBUG as compiler flag"></a>Add <code>-DNDEBUG</code> as compiler flag</h2><p>If <code>-DNDEBUG</code> is added, all the <code>assert</code> s are stripped away from source code.  </p>
<h2 id="Use-strip-command-to-get-rid-of-unneeded-sections-in-binary"><a href="#Use-strip-command-to-get-rid-of-unneeded-sections-in-binary" class="headerlink" title="Use strip command to get rid of unneeded sections in binary"></a>Use <code>strip</code> command to get rid of unneeded sections in binary</h2><p>Use <code>strip</code> with <code>-s</code> and <code>--strip-unneeded</code> will strip away a lot of sections not needed by binary.</p>
<p>Also, <code>.note.ABI-tag</code>, <code>.note.gnu.build-id</code> and <code>.comment</code> sections can also be removed.</p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc."></a>Misc.</h2><ul>
<li>If there are still visible strings left, use <code>objdump</code> and <code>readelf</code> on the object file that the string might come from, to locate which section does the string come from. </li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mli9502.github.io/2018/09/26/Hide-human-readable-information-in-c-binary/" data-id="cjr8qyr1t000arg6tpnbghu1w" class="article-share-link">Share</a>
      
        <a href="https://mli9502.github.io/2018/09/26/Hide-human-readable-information-in-c-binary/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/">c++</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-todo-algorithms" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/09/todo-algorithms/" class="article-date">
  <time datetime="2018-09-09T16:54:30.000Z" itemprop="datePublished">2018-09-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/09/todo-algorithms/">todo algorithms</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Some of the new algorithms encountered when doing leetcode. </p>
<ul>
<li><p>Bi-directional BFS.</p>
<ul>
<li><a href="https://leetcode.com/problems/word-ladder/description/" target="_blank" rel="noopener">leetcode 127</a></li>
<li><a href="https://leetcode.com/problems/open-the-lock/description/" target="_blank" rel="noopener">leetcode 752</a></li>
<li><a href="https://www.geeksforgeeks.org/bidirectional-search/" target="_blank" rel="noopener">link to the algorithm</a></li>
</ul>
</li>
<li><p>Segment Tree.</p>
<ul>
<li><a href="https://leetcode.com/problems/range-sum-query-mutable/description/" target="_blank" rel="noopener">leetcode 307</a></li>
<li><a href="https://www.youtube.com/watch?v=Tr-xEGoByFQ" target="_blank" rel="noopener">youtube video for segment tree</a></li>
</ul>
</li>
<li><p>Uniqueness of topological sort.</p>
<ul>
<li><a href="https://leetcode.com/problems/sequence-reconstruction/description/" target="_blank" rel="noopener">leetcode 444</a></li>
<li><a href="https://en.wikipedia.org/wiki/Topological_sorting" target="_blank" rel="noopener">wiki-link</a></li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mli9502.github.io/2018/09/09/todo-algorithms/" data-id="cjr8qyr21000hrg6t7obs7wvr" class="article-share-link">Share</a>
      
        <a href="https://mli9502.github.io/2018/09/09/todo-algorithms/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Misc/">Misc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/">leetcode</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Misc/" style="font-size: 13.33px;">Misc</a> <a href="/tags/algorithm/" style="font-size: 20px;">algorithm</a> <a href="/tags/c/" style="font-size: 13.33px;">c++</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/leetcode/" style="font-size: 16.67px;">leetcode</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/11/14/leetcode-850-Rectangle-Area-II/">leetcode 850 - Rectangle Area II</a>
          </li>
        
          <li>
            <a href="/2018/11/14/Fenwick-Tree/">Fenwick Tree</a>
          </li>
        
          <li>
            <a href="/2018/11/14/Segment-Tree/">Segment Tree</a>
          </li>
        
          <li>
            <a href="/2018/10/24/leetcode-765-Couples-Holding-Hands/">leetcode 765 - Couples Holding Hands</a>
          </li>
        
          <li>
            <a href="/2018/10/18/Articles-to-read/">Articles to read</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Mengwen Li<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'https-mli9502-github-io';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>